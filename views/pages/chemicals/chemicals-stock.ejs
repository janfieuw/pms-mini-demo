<!-- views/pages/chemicals/chemicals-stock.ejs -->

<div class="card shadow-sm mb-4">
  <div class="card-header">
  <h1 style="margin-bottom:2px;">CHEMICALS â€¢ STOCK</h1>
 <span style="font-family:'Roboto Mono', monospace; font-size:10px; color:#646464;">Overview of the stock level and available batches. You can change the alert level.</span><br><br>
  </div>
<br>
  <div class="card-body p-0">

    <style>
      /* Raster: 4 kolommen zoals in je voorbeeld */
      .chem-grid {
        display: grid;
        grid-template-columns: 300px 150px 120px 120px;
        column-gap: 12px;
        row-gap: 3px;
        font-size: 12px;
      }

      .chem-stock-green { color:#1a7f13; font-weight:bold; }
      .chem-stock-red { color:#b30000; font-weight:bold; }

      .chem-alert-input {
        width: 60px;
        text-align: center;
        border: 1px solid #e0c36c;
        border-radius:6px; 
        background-color: #fff9c4;
        font-weight: bold;
        padding: 2px 4px;
      }

      .batch-row {
        display: contents; /* batches volgen perfect de grid */
      }

      .batch-lot {
        padding-left: 10px;
      }

      /* WITREGEL tussen artikels */
      .article-block {
        margin-bottom: 10px;
      }
    </style>

    <% stock.forEach(item => { %>

      <!-- Artikelblok -->
      <div class="article-block">

        <div class="chem-grid">

          <!-- Kolom 1: Artikelnaam -->
          <div style="font-weight:bold;">
            <%= item.articleId %> - <%= item.articleName %>
          </div>

          <!-- Kolom 2: X in stock (groen/rood) -->
          <div>
            <% if (item.totalAvailable >= item.stockAlertValue) { %>
              <span class="chem-stock-green"><%= item.totalAvailable %> in stock</span>
            <% } else { %>
              <span class="chem-stock-red"><%= item.totalAvailable %> in stock</span>
            <% } %>
          </div>

          <!-- Kolom 3: Stock alert label -->
          <div>Stock alert</div>

          <!-- Kolom 4: Geel vakje + SAVE-knop -->
          <div>
            <form action="/chemicals/stock/<%= item.articleId %>/alert"
                  method="POST"
                  style="margin:0; display:flex; align-items:center; gap:4px;">
              <input
                type="number"
                name="stockAlertValue"
                value="<%= item.stockAlertValue %>"
                min="0"
                step="1"
                class="chem-alert-input"
              >
              <button type="submit"
                      class="btn btn-dark btn-sm"
                      style="padding: 6px; font-size:9px; line-height:1;">
                SAVE
              </button>
            </form>
          </div>

          <!-- Batch-rijen in dezelfde grid -->
          <% item.batches.forEach(batch => { %>
            <% if (batch.availableQuantity > 0) { %>
              <div class="batch-row">

                <!-- Kolom 1: lotnummer -->
                <div class="batch-lot"><%= batch.lotNumber %></div>

                <!-- Kolom 2: hoeveelheid -->
                <div>#<%= batch.availableQuantity %></div>

                <!-- Kolom 3 leeg -->
                <div></div>

                <!-- Kolom 4 leeg -->
                <div></div>

              </div>
            <% } %>
          <% }) %>

        </div>
      </div>

    <% }) %>

  </div>
</div>

