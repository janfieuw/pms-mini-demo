<style>
  /* Zelfde CSS als messages.ejs */

  .messages-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
  }

  .messages-table td {
    padding: 4px 6px;
    vertical-align: top;
  }

  .msg-main-cell {
    width: 100%;
  }

  .msg-icons-cell {
    width: 65px;
    text-align: center;
    white-space: nowrap;
  }

  .message-block {
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 6px 8px;
  }

  .msg-header-row {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
    margin-bottom: 4px;
  }

  .msg-meta {
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    font-weight: 600;
  }

  .msg-label-row {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 4px;
    margin-bottom: 4px;
    padding-bottom: 0;
  }

  .msg-body {
    margin-top: 0;
    padding-top: 0;
    font-size: 11px;
    white-space: pre-wrap;
  }

  .tag {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 145px !important;
    min-width: 145px !important;
    max-width: 145px !important;
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    height: 24px;
    border-radius: 4px;
    background-color: #346388;
    color: #ffffff;
    border: none;
    margin: 2px 3px;
    white-space: nowrap;
  }

  .start {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 145px !important;
    min-width: 145px !important;
    max-width: 145px !important;
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    height: 24px;
    border-radius: 4px;
    background-color: #34885e;
    color: #ffffff;
    border: none;
    margin: 2px 3px;
    white-space: nowrap;
  }

  .stop {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 145px !important;
    min-width: 145px !important;
    max-width: 145px !important;
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    height: 24px;
    border-radius: 4px;
    background-color: #ee3107;
    color: #ffffff;
    border: none;
    margin: 2px 3px;
    white-space: nowrap;
  }

  .safety {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 145px !important;
    min-width: 145px !important;
    max-width: 145px !important;
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    height: 24px;
    border-radius: 4px;
    background-color: #ff9100;
    color: #ffffff;
    border: none;
    margin: 2px 3px;
    white-space: nowrap;
  }

  .must {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 145px !important;
    min-width: 145px !important;
    max-width: 145px !important;
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    height: 24px;
    border-radius: 4px;
    background-color: #ffea00;
    color: #6f6f6f;
    border: none;
    margin: 2px 3px;
    white-space: nowrap;
  }

  .info {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 145px !important;
    min-width: 145px !important;
    max-width: 145px !important;
    font-family: 'Roboto Mono', monospace;
    font-size: 11px;
    height: 24px;
    border-radius: 4px;
    background-color: #ebebeb;
    color: #2c2c2c;
    border: 0px solid #2c2c2c;
    margin: 2px 3px;
    white-space: nowrap;
  }

  .tag.wms { display: inline-flex; }

  /* Blauwe label voor TOPIC categorie (INSTRUCTIONS / HR / ...) */
.topic-type-tag {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:145px !important;
    min-width:145px !important;
    max-width:145px !important;
    font-family:'Roboto Mono', monospace;
    font-size:11px;
    height:24px;
    border-radius:4px;
    background-color:#f9b9aa;   /* << nieuwe kleur */
    color:#2c2c2c;              /* donkergrijs voor leesbaarheid */
    border:none;
    margin:2px 3px;
    white-space:nowrap;
}


  .icon-btn{
    width:28px;
    height:28px;
    border:1px solid #ddd;
    background:#ffffff;
    border-radius:6px;
    padding:0;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
  }

  .icon-btn:hover{
    background:#fdc500;
  }

  .icon-btn i { font-size: 11px; }

  .messages-help-text {
    font-family:'Roboto Mono', monospace;
    font-size:11px;
    color:#646464;
  }

  .attachments-row {
    margin-top: 6px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
</style>

<section class="card">
  <h1 style="margin-bottom:2px;">LOGBOOK â€¢ MY NOTEBOOK</h1>
  <span class="messages-help-text">
    Your personal notebook. Add posted messages or add them by selecting NOTEBOOK ONLY in the form.
  </span>
  <br><br>

  <div class="feed">

    <% if (!items.length) { %>
      <p class="muted" style="font-size:11px;">No notes yet.</p>
    <% } %>

    <%
      function fmtDateTime(n) {
        const pad = x => x < 10 ? '0' + x : x;
        const src = n.createdAt || n.savedAt;
        const d = src ? new Date(src) : null;
        if (!d || isNaN(d)) {
          return (n.time || '').trim();
        }
        const dateStr = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
        const timeStr = n.time || `${pad(d.getHours())}:${pad(d.getMinutes())}`;
        return `${dateStr} - ${timeStr}`;
      }
    %>

    <% if (items.length) { %>
      <table class="messages-table">
        <tbody>
        <% items.forEach(n => { %>
          <tr>
            <!-- LINKERKOLOM -->
            <td class="msg-main-cell">
              <div class="message-block">

                <div class="msg-header-row">
                  <span class="msg-meta">
                    <%= n.user || (currentUser && currentUser.code) || '' %> - <%= fmtDateTime(n) %> :
                  </span>
                </div>

                <div class="msg-label-row">
                  <% (n.infoLabels||[]).forEach(l => { %>
                    <span class="info"><%= l %></span>
                  <% }) %>

                  <% (n.software||[]).forEach(l => { %>
                    <span class="tag"><%= l %></span>
                  <% }) %>

                  <% if (n.calc==='START') { %><span class="start">START</span><% } %>
                  <% if (n.calc==='STOP')  { %><span class="stop">STOP</span><% } %>
                  <% if (n.calc==='QC')    { %><span class="tag">QC</span><% } %>

                  <% if (n.push==='MUST-READ') { %><span class="must">MUST-READ</span><% } %>
                  <% if (n.push==='SAFETY')    { %><span class="safety">SAFETY</span><% } %>

                  <% if (n.wms) { %>
                    <span class="tag wms"><%= (n.wms === 'IB-RAW' ? 'RAW-IB' : n.wms) %></span>
                  <% } %>

                  <% if (n.chemswitch) { %>
                    <span class="tag wms">CHEM-SWITCH</span>
                  <% } %>

                  <% if (n.chemib) { %>
                    <span class="tag wms">CHEM-IB</span>
                  <% } %>

                  <% if (n.bulkob) { %>
                    <span class="tag wms">BULK-OB</span>
                  <% } %>

                  <% if (n.qc) { %>
                    <span class="tag">QUALITY CHECK</span>
                  <% } %>

                  <% if (n.topicType) { %>
                    <span class="topic-type-tag"><%= n.topicType %></span>
                  <% } %>
                </div>

                <div class="msg-body"><%= n.message || '(no message)' %></div>

                <% if (n.attachments && n.attachments.length) { %>
                  <div class="attachments-row">
                    <% n.attachments.forEach(a => { %>
                      <% if (a && a.mime && a.mime.startsWith('image/')) { %>
                        <a class="thumb" href="<%= a.href %>" target="_blank" rel="noopener"
                           style="border:1px solid #e6e6ee;border-radius:8px;overflow:hidden;display:inline-block;">
                          <img src="<%= a.href %>" alt="<%= a.name %>"
                               style="display:block;max-width:77px;max-height:56px;object-fit:contain;">
                        </a>
                      <% } else if (a && a.href) { %>
                        <a class="doc" href="<%= a.href %>" target="_blank" rel="noopener"
                           style="display:inline-flex;align-items:center;padding:6px 10px;border:1px solid #e6e6ee;border-radius:8px;background:#fff;text-decoration:none;font-size:11px;">
                          ðŸ“„ <span style="margin-left:6px; word-break:break-all;"><%= a.name || 'Document' %></span>
                        </a>
                      <% } %>
                    <% }) %>
                  </div>
                <% } %>

              </div>
            </td>

            <!-- RECHTERKOLOM: remove from notebook -->
            <td class="msg-icons-cell">
              <form method="post" action="/logbook/remove-notebook">
                <input type="hidden" name="id" value="<%= n.id %>"/>
                <button class="icon-btn active" title="Remove from notebook">
                  <i data-lucide="notebook-pen"></i>
                </button>
              </form>
            </td>
          </tr>
        <% }) %>
        </tbody>
      </table>
    <% } %>

  </div>
</section>
