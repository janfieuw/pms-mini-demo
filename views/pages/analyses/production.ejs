<!-- views/pages/analyses/production.ejs -->
<style>
  .page-card{
    background:transparent!important;
    box-shadow:none!important;
    border:none!important;
    margin:0!important;
    padding:0!important;
  }
  main, body{
    margin:0!important;
    padding:0!important;
  }
</style>

<%
  const avg   = typeof avgProduced === 'number' ? avgProduced : 0;
  const upper = avg + 15; // +15% boven gemiddelde => groen
  const lower = avg - 15; // -15% onder gemiddelde => rood
%>

<div style="max-width:1100px;margin:0 auto 24px auto;background:#ffffff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,0.12);padding:24px;border:1px solid rgba(0,0,0,0.08);">

  <h2>ANALYSES • PRODUCTION</h2>

  <!-- Kader met gemiddelde productie -->
  <div style="margin:16px 0 24px 0; padding:16px; border-radius:12px; background:#ededed; display:flex; flex-direction:column; gap:4px;">
    <div style="font-size:12px; text-transform:uppercase; letter-spacing:0.08em; color:#555;">
      Average produced (all shifts)
    </div>
    <div style="font-size:24px; font-weight:700;">
      <%= avg.toFixed(0) %> kg
    </div>
    <div style="font-size:11px; color:#777;">
      Green ≥ <%= upper.toFixed(0) %> kg  •  Red ≤ <%= lower.toFixed(0) %> kg
    </div>
  </div>

  <% if (!(rows && rows.length)) { %>
    <p class="muted">No production data yet.</p>
  <% } else { %>
    <div style="overflow:auto;">
      <table style="width:100%; border-collapse:collapse; font-size:10px;">
        <thead>
          <tr style="background:#f7f7f7;">
            <th style="text-align:left;  padding:8px; border-bottom:1px solid #ddd;">#</th>
            <th style="text-align:left;  padding:8px; border-bottom:1px solid #ddd;">Operator</th>
            <th style="text-align:left;  padding:8px; border-bottom:1px solid #ddd;">Start label</th>
            <th style="text-align:left;  padding:8px; border-bottom:1px solid #ddd;">End label</th>
            <th style="text-align:right; padding:8px; border-bottom:1px solid #ddd;">Produced (kg)</th>
          </tr>
        </thead>
        <tbody>
          <% rows.forEach((r, idx) => {
               const valRaw = (r && (r.produced ?? r.Produced ?? r.production ?? r.prodKg)) || 0;
               const val    = Number(valRaw) || 0;

               let color = '#000000';
               let weight = '400';

               if (val >= upper) {
                 color = '#0b7c17'; // groen
                 weight = '700';
               } else if (val <= lower) {
                 color = '#b00020'; // rood
                 weight = '700';
               }
          %>
            <tr>
              <td style="padding:8px; border-bottom:1px solid #eee;"><%= idx + 1 %></td>
              <td style="padding:8px; border-bottom:1px solid #eee;"><%= r.operator || '' %></td>
              <td style="padding:8px; border-bottom:1px solid #eee; white-space:nowrap;"><%= r.startLabel || '' %></td>
              <td style="padding:8px; border-bottom:1px solid #eee; white-space:nowrap;"><%= r.endLabel || '' %></td>
              <td style="padding:8px; border-bottom:1px solid #eee; text-align:right; color:<%= color %>; font-weight:<%= weight %>;">
                <%= val.toFixed(0) %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>
</div>
